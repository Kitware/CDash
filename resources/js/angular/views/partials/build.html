<!-- Selection checkbox for bulk actions (admin only) -->
<td ng-if="cdash.user.admin == 1 && buildgroup.selectionMode" align="center" class="paddt">
  <input type="checkbox" 
         ng-if="::build.id"
         ng-model="build.selected" 
         ng-change="toggleBuildSelection(build, buildgroup)"
         data-cy="build-selection-checkbox">
</td>

<!-- For child view, display the label(s) as a link to the build summary -->
<td ng-if="::cdash.childview == 1" align="left" class="paddt" colspan="2">
  <a class="cdash-link" ng-href="builds/{{::build.id}}">
    {{::build.label}}
  </a>

  <!-- Icon for build errors / test failing -->
  <a class="cdash-link" ng-if="::build.compilation.error > 0 || build.test.fail > 0" href=""
     ng-click="toggleBuildProblems(build)">
    <span class="glyphicon glyphicon-info-sign" style="color: #777;" title="Build information"></span>
  </a>

  <!-- Link to notes specific to this subproject build -->
  <a class="cdash-link"
     title="View notes"
     name="notesLink"
     ng-if="::build.notes > 0"
     ng-href="builds/{{::build.id}}/notes">
    <span class="glyphicon glyphicon-file" style="color: #777;"></span>
  </a>
</td>

<!-- Otherwise, show build name & site on the row. -->
<td ng-if="::cdash.childview != 1" align="left" class="paddt">
  <a class="cdash-link" ng-href="sites/{{::build.siteid}}?project={{::cdash.projectid}}&currenttime={{::cdash.unixtimestamp}}">{{::build.site}}</a>
  <span ng-if="::build.siteoutoforder == 1" class="glyphicon glyphicon-flag" style="color: #d9534f;" title="Site out of order"></span>
</td>

<td ng-if="::cdash.childview != 1" align="left">
  <div ng-if="::build.id && build.buildplatform.length > 0" style="float:left;">
    <img class="icon" alt="platform" ng-src="img/platform_{{::build.buildplatform}}.png"/>
  </div>

  <div ng-if="::build.id" style="float: left; margin: 0px 4px;">
    <a class="buildinfo cdash-link" alt="generator"
       ng-if="::build.numchildren == 0"
       ng-href="builds/{{::build.id}}">
      {{::build.buildname}}
    </a>
    <a class="buildinfo cdash-link" alt="generator"
       ng-if="::build.numchildren > 0"
       ng-href="{{::build.multiplebuildshyperlink}}">
      {{::build.buildname}}
    </a>
  </div>

  <div ng-if="::!build.id" style="float: left; margin: 0px 4px;">{{::build.buildname}}</div>

  <div style="float:left;">
    <a class="cdash-link"
       title="View notes"
       name="notesLink"
       ng-if="::build.notes > 0"
       ng-href="builds/{{::build.id}}/notes">
      <span class="glyphicon glyphicon-file" style="color: #777; margin-right: 4px;"></span>
    </a>

    <a class="cdash-link"
       href="" style="float: left;"
       ng-if="::build.uploadfilecount > 0"
       ng-href="builds/{{::build.id}}/files"
       title="{{::build.uploadfilecount}} files uploaded with this build">
      <span class="glyphicon glyphicon-compressed" style="color: #5cb85c; margin-right: 4px;"></span>
    </a>

    <!-- If the build has errors or test failing -->
    <a class="cdash-link"
       href="" style="float: left;"
       ng-if="::build.compilation.error > 0 || build.test.fail > 0"
       ng-click="toggleBuildProblems(build)">
      <span class="glyphicon glyphicon-info-sign" style="color: #777; margin-right: 4px;" title="Build information"></span>
    </a>

    <!-- If the build is expected and missing -->
    <a class="cdash-link"
       href="" style="float: left;"
       ng-if="::build.expectedandmissing == 1"
       ng-click="toggleExpectedInfo(build)">
      <span class="glyphicon glyphicon-info-sign" style="color: #777; margin-right: 4px;" title="Expected build information"></span>
    </a>

    <!-- Display the note icon -->
    <a class="cdash-link" name="Build Notes" id="buildnote_{{::build.id}}"
       ng-if="::build.buildnotes > 0"
       ng-href="ajax/buildnote.php?buildid={{::build.id}}">
      <span class="glyphicon glyphicon-comment" style="color: #337ab7; margin-right: 4px;"></span>
    </a>

    <div style="float: left;" ng-if="::cdash.user.admin == 1">
      <!-- Display cog icon to edit this build for administrative users -->
      <a class="cdash-link" href="" ng-click="toggleAdminOptions(build)">
        <span name="adminoptions" class="glyphicon glyphicon-cog" style="color: #777; margin-right: 4px;" data-cy="build-admin-options"></span>
      </a>
      <span class="glyphicon glyphicon-refresh glyphicon-spin" ng-if="build.loading == 1" style="color: #5bc0de;"></span>
    </div>
  </div>

  <!-- Problematic build history table -->
  <div ng-if="::build.compilation.error > 0 || build.test.fail > 0">
    <table width="100%" border="0" ng-if="build.showProblems" class="animate-show">
      <tbody>
        <tr ng-if="::build.hasErrors">
          <td bgcolor="#DDDDDD" id="nob">
            <font size="2">
              Build has been failing since
              <b>
                <a class="cdash-link" ng-href="index.php?project={{::cdash.projectname}}&date={{::build.failingDate}}">
                  {{::build.failingSince}}
                </a>
                (<ng-pluralize count="::build.daysWithErrors"
                              when="{'0':     'today',
                                     '1':     '{} day',
                                     'other': '{} days'}">
                </ng-pluralize>)
              </b>
            </font>
          </td>
        </tr>
        <tr ng-if="::build.hasFailingTests">
          <td bgcolor="#DDDDDD" id="nob">
            <font size="2">
              Tests have been failing since
              <b>
                <a class="cdash-link" ng-href="index.php?project={{::cdash.projectname}}&date={{::build.testsFailingDate}}">
                  {{::build.testsFailingSince}}
                </a>
                (<ng-pluralize count="::build.daysWithFailingTests"
                              when="{'0':     'today',
                                     '1':     '{} day',
                                     'other': '{} days'}">
                </ng-pluralize>)
              </b>
            </font>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- expected info table -->
  <div ng-if="::build.expectedandmissing == 1">
    <table width="100%" border="0" ng-if="build.showExpectedInfo" class="animate-show">
      <tbody>
        <tr>
          <td bgcolor="#DDDDDD" id="nob">
            <font size="2">
              <span ng-if="::build.lastSubmission == -1">
                This build has never submitted.
              </span>
              <span ng-if="::build.lastSubmission != -1">
                This build has not submitted since
                <b>
                  <a class="cdash-link" ng-href="index.php?project={{::cdash.projectname}}&date={{::build.lastSubmissionDate}}">
                    {{::build.lastSubmission}}
                  </a>
                  (<ng-pluralize count="::build.daysSinceLastBuild"
                                when="{'1':     '{} day',
                                       'other': '{} days'}">
                  </ng-pluralize>)
                </b>
              </span>
            </font>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- admin options table -->
  <div ng-if="::cdash.user.admin == 1">
    <div ng-if="build.showAdminOptions == 1" style="margin-top: 8px;">
      <table width="100%" border="0" class="animate-show">
        <!-- If user is admin of the project propose to group this build -->
        <tr ng-repeat="group in ::cdash.all_buildgroups">
          <td width="35%" style="padding: 4px 0;">
            <b>{{::group.name}}</b>:
          </td>
          <td ng-if="::group.name == buildgroup.name" colspan="2" style="padding: 4px 0;">
            <button class="btn btn-xs" 
                    ng-class="(build.expected == 1 || build.expectedandmissing == 1) ? 'btn-warning' : 'btn-success'" 
                    ng-click="toggleExpected(build, group.id)" 
                    ng-disabled="build.expectedLoading"
                    data-cy="{{(build.expected == 1 || build.expectedandmissing == 1) ? 'mark-as-non-expected-btn' : 'mark-as-expected-btn'}}">
              <span class="glyphicon" ng-class="{
                'glyphicon-ok': !build.expectedLoading && (build.expected != 1 && build.expectedandmissing != 1),
                'glyphicon-remove': !build.expectedLoading && (build.expected == 1 || build.expectedandmissing == 1)
              }"></span>
              <span ng-if="!build.expectedLoading && (build.expected != 1 && build.expectedandmissing != 1)">Mark as Expected</span>
              <span ng-if="!build.expectedLoading && (build.expected == 1 || build.expectedandmissing == 1)">Mark as Non Expected</span>
            </button>
          </td>
          <td ng-if="::group.name != buildgroup.name" colspan="2" style="padding: 4px 0;">
            <label style="font-weight: normal; margin: 0;">
              <input type="checkbox" ng-model="build.expectedInGroup[group.id]" ng-true-value="true" ng-false-value="false"> expected
            </label>
          </td>
          <td ng-if="::group.name != buildgroup.name" class="nob" style="padding: 4px 0;">
            <button class="btn btn-xs btn-primary" ng-click="moveToGroup(build, group.id)">
              <span class="glyphicon glyphicon-arrow-right"></span> Move to Group
            </button>
          </td>
        </tr>
        <tr>
          <td colspan="3" class="nob" style="padding: 8px 0;">
            <button class="btn btn-xs btn-danger" ng-click="showModal(build)">
              <span class="glyphicon glyphicon-trash"></span> Remove This Build
            </button>
          </td>
        </tr>
      </table>

      <div tooltip-popup-delay="1500"
           tooltip-append-to-body="true"
           uib-tooltip="Done builds will be overwritten if a new one is submitted with the same site, build name, and timestamp."
           style="margin-top: 4px;"
           ng-if="build.id && !build.expectedandmissing">
        <button class="btn btn-xs" 
                ng-class="build.done == 1 ? 'btn-default' : 'btn-info'" 
                ng-click="toggleDone(build)" 
                ng-disabled="build.doneLoading">
          <span class="glyphicon" ng-class="{
            'glyphicon-ok-circle': !build.doneLoading && build.done != 1,
            'glyphicon-ban-circle': !build.doneLoading && build.done == 1
          }"></span>
          <span ng-if="!build.doneLoading && build.done != 1">Mark as Done</span>
          <span ng-if="!build.doneLoading && build.done == 1">Mark as Not Done</span>
        </button>
      </div>
    </div>
  </div>

  <!-- changeid link/icon -->
  <div ng-if="::build.changelink">
    <a class="cdash-link" target="_blank" ng-href="{{::build.changelink}}">
      <img class="smallicon" ng-src="{{::build.changeicon}}"/>
    </a>
  </div>

</td>

<td ng-if="::buildgroup.hasupdatedata" align="center"
    ng-class="::!build.hasupdate ? '' : (
                build.update.errors == 1 ? 'error': (
                build.update.warning == 1 ? 'warning' : 'normal'))">
  <div ng-if="::build.hasupdate">
    <a class="cdash-link" ng-href="builds/{{::build.id}}/update">
      {{::build.update.files}}
    </a>
  </div>
</td>

<td ng-if="::buildgroup.hasupdatedata && cdash.advancedview != 0 && cdash.showstarttime"
    align="center">
  <div ng-if="::build.hasupdate">
    {{::build.update.time}}
  </div>
</td>

<td ng-if="::buildgroup.hasconfiguredata" align="center" ng-class="::{'error': build.configure.error > 0, 'normal': build.configure.error == 0}">
  <div ng-if="::build.hasconfigure">
    <a class="cdash-link" ng-href="builds/{{::build.id}}/configure">
      {{::build.configure.error}}
    </a>
  </div>
</td>

<td ng-if="::buildgroup.hasconfiguredata" align="center" ng-class="::{'warning': build.configure.warning > 0, 'normal': build.configure.warning == 0}">
  <div ng-if="::build.hasconfigure">
    <a class="cdash-link" ng-href="builds/{{::build.id}}/configure">
      {{::build.configure.warning}}
    </a>
    <sub ng-if="::build.configure.warningdiff > 0">+{{::build.configure.warningdiff}}</sub>
    <sub ng-if="::build.configure.warningdiff < 0">{{::build.configure.warningdiff}}</sub>
  </div>
</td>

<td ng-if="::buildgroup.hasconfiguredata && cdash.advancedview != 0 && cdash.showstarttime"
    align="center">
  <div ng-if="::build.hasconfigure">
    {{::build.configure.time}}
  </div>
</td>

<td ng-if="::buildgroup.hascompilationdata" align="center" ng-class="::{'error': build.compilation.error > 0, 'normal': build.compilation.error == 0}">
  <div ng-if="::build.hascompilation"
       ng-class="::{'valuewithsub': build.compilation.nerrordiffp > 0 || build.compilation.nerrordiffn > 0}">
    <a class="cdash-link" ng-href="viewBuildError.php?buildid={{::build.id}}">
      {{::build.compilation.error}}
    </a>
    <a ng-if="::build.compilation.nerrordiffp > 0" class="sup cdash-link" ng-href="viewBuildError.php?onlydeltap&buildid={{::build.id}}">
      +{{::build.compilation.nerrordiffp}}
    </a>

    <a class="cdash-link" ng-if="::build.compilation.nerrordiffn > 0" ng-href="viewBuildError.php?onlydeltan&buildid={{::build.id}}">
      <span class="sub">-{{::build.compilation.nerrordiffn}}</span>
    </a>
  </div>
</td>

<td ng-if="::buildgroup.hascompilationdata" align="center" ng-class="::{'warning': build.compilation.warning > 0, 'normal': build.compilation.warning == 0}">
  <div ng-if="::build.hascompilation"
       ng-class="::{'valuewithsub': build.compilation.nwarningdiffp > 0 || build.compilation.nwarningdiffn > 0}">
    <a class="cdash-link" ng-href="viewBuildError.php?type=1&buildid={{::build.id}}">
      {{::build.compilation.warning}}
    </a>

    <a ng-if="::build.compilation.nwarningdiffp > 0" class="sup cdash-link" ng-href="viewBuildError.php?type=1&onlydeltap&buildid={{::build.id}}">
      +{{::build.compilation.nwarningdiffp}}
    </a>
    <a class="cdash-link" ng-if="::build.compilation.nwarningdiffn > 0" ng-href="viewBuildError.php?type=1&onlydeltan&buildid={{::build.id}}">
      <span class="sub">-{{::build.compilation.nwarningdiffn}}</span>
    </a>
  </div>
</td>

<td ng-if="::buildgroup.hascompilationdata && cdash.advancedview != 0 && cdash.showstarttime"
    align="center">
  <div ng-if="::build.hascompilation">
    {{::build.compilation.time}}
  </div>
</td>

<td ng-if="::buildgroup.hastestdata" align="center" ng-class="::{'warning': build.test.notrun > 0, 'normal': build.test.notrun == 0}">
  <div ng-if="::build.hastest"
       ng-class="::{'valuewithsub': build.test.nnotrundiffp > 0 || build.test.nnotrundiffn > 0}">
    <a class="cdash-link" ng-href="{{ !cdash.testfilters && !cdash.extrafilterurl ? 'builds/' + build.id + '/tests?filters=%7B%22all%22%3A%5B%7B%22eq%22%3A%7B%22status%22%3A%22NOT_RUN%22%7D%7D%5D%7D' : 'viewTest.php?onlynotrun&buildid=' + build.id + cdash.testfilters + cdash.extrafilterurl }}">
      {{::build.test.notrun}}
    </a>
    <a ng-if="::build.test.nnotrundiffp > 0" class="sup cdash-link" ng-href="viewTest.php?onlydelta&buildid={{::build.id}}{{::cdash.testfilters}}{{::cdash.extrafilterurl}}">
      +{{::build.test.nnotrundiffp}}
    </a>
    <span ng-if="::build.test.nnotrundiffn > 0" class="sub">-{{::build.test.nnotrundiffn}}</span>
  </div>
</td>

<td ng-if="::buildgroup.hastestdata" align="center" ng-class="::{'error': build.test.fail > 0, 'normal': build.test.fail < 1}">
  <div ng-if="::build.hastest"
       ng-class="::{'valuewithsub': build.test.nfaildiffp > 0 || build.test.nfaildiffn > 0}">
    <a class="cdash-link" ng-href="{{ !cdash.testfilters && !cdash.extrafilterurl ? 'builds/' + build.id + '/tests?filters=%7B%22all%22%3A%5B%7B%22eq%22%3A%7B%22status%22%3A%22FAILED%22%7D%7D%5D%7D' : 'viewTest.php?onlyfailed&buildid=' + build.id + cdash.testfilters + cdash.extrafilterurl }}">
      {{::build.test.fail}}
    </a>
    <a ng-if="::build.test.nfaildiffp > 0" class="sup cdash-link" ng-href="viewTest.php?onlydelta&buildid={{::build.id}}{{::cdash.testfilters}}{{::cdash.extrafilterurl}}">
      +{{::build.test.nfaildiffp}}
    </a>
    <span ng-if="::build.test.nfaildiffn > 0" class="sub">
      -{{::build.test.nfaildiffn}}
    </span>
  </div>
</td>

<td ng-if="::buildgroup.hastestdata" align="center" ng-class="::{'normal': build.test.pass > -1}">
  <div ng-if="::build.hastest"
       ng-class="::{'valuewithsub': build.test.npassdiffp > 0 || build.test.npassdiffn > 0}">
    <a class="cdash-link" ng-href="{{ !cdash.testfilters && !cdash.extrafilterurl ? 'builds/' + build.id + '/tests?filters=%7B%22all%22%3A%5B%7B%22eq%22%3A%7B%22status%22%3A%22PASSED%22%7D%7D%5D%7D' : 'viewTest.php?onlypassed&buildid=' + build.id + cdash.testfilters + cdash.extrafilterurl }}">
      {{::build.test.pass}}
    </a>
    <a ng-if="::build.test.npassdiffp > 0" class="sup cdash-link" ng-href="viewTest.php?onlydelta&buildid={{::build.id}}{{::cdash.testfilters}}{{::cdash.extrafilterurl}}">
      +{{::build.test.npassdiffp}}
    </a>

    <span ng-if="::build.test.npassdiffn > 0" class="sub">
      -{{::build.test.npassdiffn}}
    </span>
  </div>
</td>

<td align="center"
    ng-if="::buildgroup.hastestdata && cdash.showtesttime"
    ng-class="::{'error': build.test.timestatus > 0, 'normal': build.test.timestatus == 0}">
  <div ng-if="::build.hastest"
       ng-class="::{'valuewithsub': build.build.test.ntimediffp > 0 || build.test.ntimediffn > 0}">
    <div ng-if="::build.test.timestatus > 0">
      <a class="cdash-link" ng-href="{{ !cdash.testfilters && !cdash.extrafilterurl ? 'builds/' + build.id + '/tests?filters=%7B%22all%22%3A%5B%7B%22eq%22%3A%7B%22timeStatusCategory%22%3A%22FAILED%22%7D%7D%5D%7D' : 'viewTest.php?onlytimestatus&buildid=' + build.id + cdash.testfilters + cdash.extrafilterurl }}">
        {{::build.test.timestatus}}
      </a>
      <a ng-if="::build.test.ntimediffp > 0" class="sup cdash-link" ng-href="viewTest.php?onlydelta&buildid={{::build.id}}{{::cdash.testfilters}}{{::cdash.extrafilterurl}}">
        +{{::build.test.ntimediffp}}
      </a>
      <span ng-if="::build.test.ntimediffn > 0" class="sub">
        -{{::build.test.ntimediffn}}
      </span>
    </div>

    <span ng-if="::build.test.timestatus">
      {{::build.test.time}}
      <a ng-if="::build.test.ntimediffp > 0" class="sup cdash-link" ng-href="viewTest.php?onlydelta&buildid={{::buildid}}{{::cdash.testfilters}}{{::cdash.extrafilterurl}}">
        +{{::build.test.ntimediffp}}
      </a>
      <span ng-if="::build.test.ntimediffn > 0" class="sub">
        -{{::build.test.ntimediffn}}
      </span>
    </span>

    <span ng-if="::!build.test.timestatus">
      {{::build.test.time}}
    </span>
  </div>
</td>

<td align="center"
    ng-if="::buildgroup.hastestdata && cdash.advancedview != 0 && cdash.showProcTime">
  {{::build.test.procTime}}
</td>

<td align="center" ng-if="::cdash.showstarttime">
  <span ng-if="::!build.builddate" class="builddateelapsed" alt="Expected submit time: {{::build.expectedstarttime}}">
    Expected build
  </span>

  <div ng-if="::build.builddate">
    <span class="builddateelapsed" title="{{::build.timesummary}}">
      {{::build.builddateelapsed}}
    </span>
  </div>
</td>

<td align="center" ng-if="::cdash.showorder">
  {{::build.position}}
</td>

<!-- display the labels -->
<td ng-if="::cdash.childview != 1 && cdash.displaylabels == 1" class="nob" align="left">
  {{::build.label}}
</td>
