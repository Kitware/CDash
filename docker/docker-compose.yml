name: cdash
services:
  cdash:
    image: kitware/cdash
    container_name: cdash
    build:
      context: ..
      target: cdash
      # Set the environment variable BASE_IMAGE=ubi to use RedHat UBI as base image
      args:
       BASE_IMAGE: ${BASE_IMAGE-debian}
    environment:
      DB_HOST: database
    healthcheck:
      test: curl -s -o /dev/null -w "%{http_code}" http://cdash:8080/ping | grep 200 > /dev/null
      interval: 5s
      timeout: 10s
      retries: 20
    depends_on:
      database:
        condition: service_healthy
    links:
      - database
    volumes:
      - type: volume
        source: storage
        target: /cdash/storage
volumes:
  storage:
